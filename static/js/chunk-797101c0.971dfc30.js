(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-797101c0"],{"8e47":function(e,a,t){"use strict";t.r(a);var r=function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("div",[t("a-card",{attrs:{title:e.editTitle}},[t("a-form",{attrs:{form:e.form,layout:"horizontal"}},[t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"驱动名称",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["driverName",{rules:[{required:!0,message:"请输入驱动名称"}]}],expression:"[\n                'driverName',\n                { rules: [{ required: true, message: '请输入驱动名称' }] },\n              ]"}],attrs:{placeholder:"请输入"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"驱动标识",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["driverId",{rules:[{required:!0,message:"请输入驱动标识"}]}],expression:"[\n                'driverId',\n                { rules: [{ required: true, message: '请输入驱动标识' }] },\n              ]"}],attrs:{placeholder:"请输入"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{staticClass:"tips",attrs:{label:"驱动上传",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol,required:""}},[t("a-upload",{attrs:{name:"file",multiple:!1,customRequest:e.customRequest,fileList:e.fileList,beforeUpload:e.handleBeforeUpload,remove:e.fileRemove,showUploadList:{showRemoveIcon:!0,showDownloadIcon:!0}},on:{download:e.handleDownload}},[t("a-button",[t("a-icon",{attrs:{type:"upload"}}),e._v("上传文件")],1)],1),t("span",{staticClass:"greybb"})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"驱动版本",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["driverVersion",{rules:[{required:!0,message:"请输入驱动名称"}]}],expression:"[\n                'driverVersion',\n                { rules: [{ required: true, message: '请输入驱动名称' }] },\n              ]"}],attrs:{placeholder:"请输入"}})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"驱动适用网关类型",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["productIds",{rules:[{required:!0,message:"驱动适用网关类型"}]}],expression:"[\n                'productIds',\n                { rules: [{ required: true, message: '驱动适用网关类型' }] },\n              ]"}],attrs:{placeholder:"请选择",mode:"multiple"}},e._l(e.productList,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v(" "+e._s(a.productName)+" ")])})),1)],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"驱动适用子协议",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["subprotoIds",{rules:[{required:!0,message:"驱动适用子协议"}]}],expression:"[\n                'subprotoIds',\n                { rules: [{ required: true, message: '驱动适用子协议' }] },\n              ]"}],attrs:{placeholder:"请选择",mode:"multiple"}},e._l(e.protoList,(function(a){return t("a-select-option",{key:a.id,attrs:{value:a.id}},[e._v(" "+e._s(a.name)+" ")])})),1)],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"驱动参数模型",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol,required:""}},[t("a-button",{staticStyle:{color:"#1abc9c"},attrs:{icon:"plus"},on:{click:e.paramModeAdd}},[e._v("添加参数")]),t("a-table",{attrs:{columns:e.columns,"data-source":e.dataSource,size:"small",pagination:!1},scopedSlots:e._u([{key:"paramType",fn:function(a){return t("span",{},[21==a?t("label",{key:a},[e._v("驱动实例化参数")]):22==a?t("label",{key:a},[e._v("子设备连接参数")]):e._e()])}},{key:"dataType",fn:function(a){return t("span",{},[e._v(" "+e._s(e.CollectionLabel("PARAMDATATYPE",a))+" ")])}},{key:"action",fn:function(a,r){return[t("div",[t("a",{staticStyle:{"margin-right":"8px"},on:{click:function(a){return e.editRow(r)}}},[e._v(" 编辑 ")]),t("a",{on:{click:function(a){return e.remove(r.key)}}},[e._v(" 删除 ")])])]}}])})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"启动/停用",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-switch",{directives:[{name:"decorator",rawName:"v-decorator",value:["enableFlag",{valuePropName:"checked",rules:[{required:!0,message:"请选择"}],initialValue:!0}],expression:"[\n                'enableFlag',\n                {\n                  valuePropName: 'checked',\n                  rules: [{ required: true, message: '请选择' }],\n                  initialValue: true,\n                },\n              ]"}]})],1)],1)],1),t("a-row",[t("a-col",{attrs:{span:16}},[t("a-form-item",{attrs:{label:"备注",labelCol:e.formItemLayout.labelCol,wrapperCol:e.formItemLayout.wrapperCol}},[t("a-textarea",{directives:[{name:"decorator",rawName:"v-decorator",value:["description"],expression:"['description']"}],attrs:{rows:4,placeholder:"请输入"}})],1)],1)],1)],1),t("div",{staticStyle:{width:"30%",margin:"20px auto"}},[t("a-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:e.saveForm}},[e._v("提交")]),t("a-button",{staticClass:"btn",staticStyle:{"margin-left":"20px"},on:{click:e.resetForm}},[e._v("重置")])],1)],1),e.showEditProduct?t("a-modal",{attrs:{title:1==e.paramJson.editType?"添加参数":"编辑参数",width:800,visible:e.showEditProduct},on:{ok:e.ok,cancel:e.cancel}},[t("param-model",{ref:"parentForm",attrs:{paramJson:e.paramJson,groups:e.groups},on:{saveSuccess:e.saveSuccess}})],1):e._e()],1)},o=[],s=(t("4de4"),t("4160"),t("b0c0"),t("d3b7"),t("3ca3"),t("159b"),t("ddb0"),t("2b3d"),t("4bbb")),i=t("dde5"),l=t("7424"),n=t("bc3a"),u=t.n(n),d=[{title:"分组名",dataIndex:"groupName"},{title:"分组编码",dataIndex:"groupCode"},{title:"参数类型",dataIndex:"paramType",scopedSlots:{customRender:"paramType"}},{title:"参数名",dataIndex:"paramName"},{title:"标识符",dataIndex:"paramTag"},{title:"数据类型",dataIndex:"dataType",scopedSlots:{customRender:"dataType"}},{title:"操作",scopedSlots:{customRender:"action"}}],c={components:{ParamModel:s["a"]},data:function(){return{form:this.$form.createForm(this,{}),formItemLayout:{labelCol:{span:6},wrapperCol:{span:18}},columns:d,showEditProduct:!1,productList:[],protoList:[],driId:this.$route.query.id,editType:this.$route.query.editType,editTitle:"",dataSource:[],paramJson:{},rowId:0,groups:[],fileList:[]}},mounted:function(){switch(this.editType){case"1":this.editTitle="驱动添加";break;case"2":this.editTitle="驱动编辑";break;case"3":this.editTitle="驱动新增版本";break}this.queryProduct(),this.querySubproto(),"2"!==this.editType&&"3"!==this.editType||(this.queryDriverInfo(this.driId),this.queryParam(this.driId))},methods:{handleBeforeUpload:function(e){var a=this,t=e.size<104857600;return new Promise((function(r,o){t?r(e):(a.$message.error("文件大小超过100M"),o(e))}))},fileRemove:function(e){var a=this,t={fileUrl:this.fileList[0].url};i["c"].deleteFile(t).then((function(e){var t=e.data;t.success?a.fileList=[]:a.$message.error("删除失败："+t.msg)}))},handleDownload:function(e){var a=this,t={name:this.fileList[0].name,url:this.fileList[0].url};i["c"].downloadFile(t).then((function(e){var a=e.data,r=new Blob([a]);if("download"in document.createElement("a")){var o=document.createElement("a");o.download=t.name,o.style.display="none",o.href=URL.createObjectURL(r),document.body.appendChild(o),o.click(),URL.revokeObjectURL(o.href),document.body.removeChild(o)}else navigator.msSaveBlob(r,t.name)})).catch((function(){a.$message.error("下载失败,请联系管理员")}))},customRequest:function(e){var a=new FormData;a.append("file",e.file),this.saveFile(a,e.file)},saveFile:function(e,a){var t=this,r=this;u()({method:"post",url:l["RESOURCE_BASE"]+"/file/uploadFile",headers:{},params:{},data:e,timeout:8e4}).then((function(e){e.data.success?t.fileList=[{uid:"-1",name:a.name,status:"done",url:e.data.obj[0].url}]:(r.$message.info("上传失败："+e.data.msg),console.log(e))})).catch((function(e){console.log(e)}))},paramModeAdd:function(){this.showEditProduct=!0,this.paramJson.editType="1",this.groups=this.uniq(this.groups)},ok:function(){this.$refs.parentForm.saveForm()},cancel:function(){this.showEditProduct=!1},uniq:function(e){for(var a=[],t={},r=0;r<e.length;r++)t[e[r].groupCode]||(a.push(e[r]),t[e[r].groupCode]=!0);return a},editRow:function(e){console.log(e),this.rowId=e.key-1,this.paramJson.editType="2",this.paramJson.row=e,this.showEditProduct=!0,this.groups=this.uniq(this.groups)},remove:function(e){var a=this.dataSource.filter((function(a){return a.key!==e}));this.dataSource=a},saveSuccess:function(){var e=this.$refs.parentForm.rowData;if(console.log(e),"1"===this.paramJson.editType)this.dataSource.push({key:this.dataSource.length+1,groupName:e.groupName,groupCode:e.groupCode,paramType:e.paramType,paramName:e.paramName,paramTag:e.paramTag,dataType:e.dataType,dataJson:e.dataJson}),this.groups.push({groupName:e.groupName,groupCode:e.groupCode});else if("2"===this.paramJson.editType){console.log(this.rowId);var a=this.rowId;this.dataSource[a].groupName=e.groupName,this.dataSource[a].groupCode=e.groupCode,this.dataSource[a].paramType=e.paramType,this.dataSource[a].paramName=e.paramName,this.dataSource[a].paramTag=e.paramTag,this.dataSource[a].dataType=e.dataType,this.dataSource[a].dataJson=e.dataJson,this.groups.push({groupName:e.groupName,groupCode:e.groupCode})}console.log(this.dataSource),this.showEditProduct=!1},queryProduct:function(){var e=this,a={enableFlag:"1",nodeType:"2"};i["f"].queryProduct(a).then((function(a){var t=a.data;t.serviceSuccess&&(e.productList=t.data.pageBean.list)}))},querySubproto:function(){var e=this;i["a"].querySubDeviceProto({enableFlag:"1"}).then((function(a){var t=a.data;t.serviceSuccess&&(e.protoList=t.data.pageBean.list)}))},queryParam:function(e){var a=this,t={driverId:e};i["e"].queryParam(t).then((function(e){var t=e.data;console.log(t),t.serviceSuccess&&(a.dataSource=t.data.pageBean.list,a.dataSource.forEach((function(e,t){e.key=t+1,a.groups.push({groupName:e.groupName,groupCode:e.groupCode})})))}))},queryDriverInfo:function(e){var a=this;i["c"].queryDriver({id:e}).then((function(e){var t=e.data;if(t.serviceSuccess){var r=t.data.pageBean.list[0];r.enableFlag="1"==r.enableFlag,r.productIds=JSON.parse("["+r.productIds+"]"),r.subprotoIds=JSON.parse("["+r.subprotoIds+"]"),"3"===a.editType?(a.fileList=[],r.driverVersion=""):a.fileList=[{uid:"-1",status:"done",name:r.jarName,url:r.jarUrl}],a.form.setFieldsValue(r)}}))},saveForm:function(){var e=this,a=this.form.getFieldsValue();if(a.enableFlag=a.enableFlag?"1":"0",a.id="2"===this.editType?this.driId:null,0!=this.fileList.length)if(0!=this.dataSource.length){var t=JSON.stringify(a.productIds);a.productIds=t.substr(1,t.length-2);var r=JSON.stringify(a.subprotoIds);a.subprotoIds=r.substr(1,r.length-2),a.list=JSON.stringify(this.dataSource),a.jarName=this.fileList[0].name,a.jarUrl=this.fileList[0].url,console.log(a),this.form.validateFields((function(t,r){t||i["c"].saveDriver(a).then((function(a){var t=a.data;console.log(t),t.serviceSuccess?(e.$message.success("保存成功"),e.$router.push({path:"/gateway/driveList",query:{}}),e.resetForm()):e.$message.error("保存失败")}))}))}else this.$message.info("请填写参数");else this.$message.info("请上传驱动")},resetForm:function(){this.form.resetFields(),this.fileList=[]}}},p=c,m=(t("d35c"),t("0c7c")),h=Object(m["a"])(p,r,o,!1,null,"0bc63eb1",null);a["default"]=h.exports},9698:function(e,a,t){},d35c:function(e,a,t){"use strict";var r=t("9698"),o=t.n(r);o.a}}]);